# æ¢ä»¶æ¸¬è©¦ç¯„ä¾‹

[![English](https://img.shields.io/badge/README-English-blue.svg)](README.md) [![ç¹é«”ä¸­æ–‡](https://img.shields.io/badge/README-ç¹é«”ä¸­æ–‡-red.svg)](README-zh.md)

é€™å€‹ç¯„ä¾‹å±•ç¤ºäº†é€²éšçš„æ¢ä»¶é©—è­‰å’Œæµç¨‹è¦å‰‡å¯¦ç¾ï¼Œä½¿ç”¨ç”¨æˆ¶å…¥è·å ´æ™¯ã€‚å®ƒæ¸¬è©¦å„ç¨®æ¢ä»¶é¡å‹ä¸¦é©—è­‰æµç¨‹æ§åˆ¶ç³»çµ±æ˜¯å¦æŒ‰é æœŸå·¥ä½œã€‚

## æ¦‚è¿°

æ¢ä»¶æ¸¬è©¦ç¯„ä¾‹å±•ç¤ºäº†ï¼š
- **å¤šç¨®æ¢ä»¶é¡å‹**ï¼šæ¸¬è©¦ä¸åŒç¨®é¡çš„æ¢ä»¶èˆ‡å„ç¨®è§¸ç™¼å ´æ™¯
- **æµç¨‹è¦å‰‡ç·¨æ’**ï¼šæ¼”ç¤ºæµç¨‹è¦å‰‡å¦‚ä½•å‹•æ…‹ä¿®æ”¹ä»£ç†è¡Œç‚º
- **è‡ªå®šç¾©æ¢ä»¶å¯¦ç¾**ï¼šå‰µå»ºè¶…è¶Šå…§å»ºé¡å‹çš„é ˜åŸŸç‰¹å®šæ¢ä»¶
- **çµæ§‹åŒ–è¼¸å‡ºæ•´åˆ**ï¼šä½¿ç”¨æ¢ä»¶èˆ‡çµæ§‹åŒ–æ•¸æ“šé©—è­‰
- **å‹•æ…‹æŒ‡ä»¤æ›´æ–°**ï¼šæ¸¬è©¦æ¢ä»¶å¦‚ä½•å³æ™‚æ”¹è®Šä»£ç†æŒ‡ä»¤

## æ¸¬è©¦çš„æ¢ä»¶é¡å‹

### 1. ğŸ¯ ç¼ºå¤±æ¬„ä½æ¢ä»¶
æ¸¬è©¦ç‰¹å®šæ•¸æ“šæ¬„ä½æ˜¯å¦å¾æ”¶é›†çš„ä¿¡æ¯ä¸­ç¼ºå¤±ã€‚

**å¯¦ç¾**ï¼š
```go
type MissingFieldsCondition struct {
    name   string
    fields []string  // è¦æª¢æŸ¥ç¼ºå¤±çš„æ¬„ä½
}
```

**ä½¿ç”¨æ¡ˆä¾‹**ï¼š
- ç¼ºå¤±è¯çµ¡ä¿¡æ¯ï¼ˆé›»å­éƒµä»¶ã€é›»è©±ï¼‰
- ç¼ºå¤±ç”¨æˆ¶åå¥½
- ä¸å®Œæ•´çš„å€‹äººè³‡æ–™æ•¸æ“š

### 2. ğŸ“‹ å®Œæˆéšæ®µæ¢ä»¶
æª¢æŸ¥å…¥è·æµç¨‹çš„ç•¶å‰éšæ®µã€‚

**å¯¦ç¾**ï¼š
```go
type CompletionStageCondition struct {
    name  string
    stage string  // è¦åŒ¹é…çš„ç›®æ¨™éšæ®µ
}
```

**éšæ®µ**ï¼š
- `basic_info`ï¼šåˆå§‹ä¿¡æ¯æ”¶é›†
- `contact_details`ï¼šé›»å­éƒµä»¶å’Œé›»è©±æ”¶é›†
- `preferences`ï¼šèˆˆè¶£å’Œåå¥½æ”¶é›†
- `completed`ï¼šå…¥è·å®Œæˆ

### 3. ğŸ’¬ è¨Šæ¯è¨ˆæ•¸æ¢ä»¶
åŸºæ–¼å°è©±ä¸­çš„è¨Šæ¯æ•¸é‡è§¸ç™¼ã€‚

**å¯¦ç¾**ï¼š
```go
type MessageCountCondition struct {
    name     string
    minCount int  // æœ€å°è¨Šæ¯é–¾å€¼
}
```

**ä½¿ç”¨æ¡ˆä¾‹**ï¼š
- é•·å°è©±å„ªåŒ–
- é€²åº¦æ‘˜è¦
- å‡ç´šè§¸ç™¼

### 4. ğŸ” æ•¸æ“šéµå­˜åœ¨æ¢ä»¶ï¼ˆå…§å»ºï¼‰
ä½¿ç”¨æ¡†æ¶çš„å…§å»ºæ¢ä»¶æª¢æŸ¥æ•¸æ“šå­˜åœ¨ã€‚

**ç”¨æ³•**ï¼š
```go
condition := agent.NewDataKeyExistsCondition("check_missing", "missing_fields")
```

## æµç¨‹è¦å‰‡é…ç½®

### è¦å‰‡ 1ï¼šè¯çµ¡ä¿¡æ¯æ”¶é›†
**æ¢ä»¶**ï¼šç¼ºå¤±é›»å­éƒµä»¶æˆ–é›»è©±
**å‹•ä½œ**ï¼š
- æ›´æ–°æŒ‡ä»¤ä»¥ç‰¹åˆ¥è©¢å•è¯çµ¡è©³æƒ…
- æ¨è–¦ `collect_user_info` å·¥å…·
- æä¾›é¼“å‹µæ€§è¨Šæ¯

### è¦å‰‡ 2ï¼šåå¥½æ”¶é›†
**æ¢ä»¶**ï¼šç¼ºå¤±åå¥½æ•¸æ“š
**å‹•ä½œ**ï¼š
- è©¢å•ç”¨æˆ¶èˆˆè¶£å’Œæ„›å¥½
- æ¨è–¦æ”¶é›†å’Œé©—è­‰å·¥å…·
- æŒ‡å°åå¥½æ ¼å¼ï¼ˆ1-5 é …ï¼Œé€—è™Ÿåˆ†éš”ï¼‰

### è¦å‰‡ 3ï¼šåŸºæœ¬ä¿¡æ¯è™•ç†
**æ¢ä»¶**ï¼šç”¨æˆ¶è™•æ–¼ basic_info éšæ®µ
**å‹•ä½œ**ï¼š
- é¦–å…ˆå°ˆæ³¨æ–¼å§“åæ”¶é›†
- è¨­å®šä¸‹ä¸€æ­¥æœŸæœ›
- æä¾›çµæ§‹åŒ–å…¥è·æµç¨‹

### è¦å‰‡ 4ï¼šé•·å°è©±å„ªåŒ–
**æ¢ä»¶**ï¼šäº¤æ›è¶…é 6 æ¢è¨Šæ¯
**å‹•ä½œ**ï¼š
- æä¾›é€²åº¦æ‘˜è¦
- æ¸…æ¥šèªªæ˜å‰©é¤˜è¦æ±‚
- æ¨è–¦å®Œæˆé©—è­‰

## å·¥å…·æ•´åˆ

### CollectInfoTool
æ”¶é›†å’Œé©—è­‰ç”¨æˆ¶ä¿¡æ¯ï¼Œå…·æœ‰æ¬„ä½ç‰¹å®šçš„é©—è­‰è¦å‰‡ã€‚

**é©—è­‰é‚è¼¯**ï¼š
- **å§“å**ï¼šæœ€å°‘ 2 å€‹å­—ç¬¦
- **é›»å­éƒµä»¶**ï¼šå¿…é ˆåŒ…å« @ å’Œ . ç¬¦è™Ÿ
- **é›»è©±**ï¼šæœ€å°‘ 10 ä½æ•¸å­—ï¼Œå¿…é ˆä»¥ 0 é–‹é ­
- **åå¥½**ï¼š1-5 é …é€—è™Ÿåˆ†éš”é …ç›®

### ValidationTool
è©•ä¼°å®Œæˆç‹€æ…‹ä¸¦ç¢ºå®šä¸‹ä¸€æ­¥ã€‚

**åŠŸèƒ½**ï¼š
- è¨ˆç®—å®Œæˆç™¾åˆ†æ¯”
- è­˜åˆ¥ç¼ºå¤±æ¬„ä½
- ç¢ºå®šç•¶å‰éšæ®µ
- æä¾›å®Œæˆå»ºè­°

## çµæ§‹åŒ–è¼¸å‡º

ä»£ç†è¿”å›åŒ…å«ä»¥ä¸‹å…§å®¹çš„ `UserStatusOutput` çµæ§‹ï¼š

```json
{
  "user_id": "user-12345",
  "name": "John Smith",
  "email": "john.smith@email.com", 
  "phone": "0123456789",
  "preferences": ["reading", "cooking", "traveling"],
  "completion_stage": "completed",
  "missing_fields": [],
  "completion_flag": true,
  "message": "å…¥è·å®Œæˆï¼æ­¡è¿åŠ å…¥ã€‚"
}
```

## æ¸¬è©¦å ´æ™¯

ç¯„ä¾‹é‹è¡Œå…¨é¢çš„æ¸¬è©¦å¥—ä»¶ï¼š

### å ´æ™¯ 1ï¼šåˆå§‹è¯çµ¡
**è¼¸å…¥**ï¼š"Hi! I want to sign up for your service."
**é æœŸ**ï¼šåŸºæœ¬ä¿¡æ¯éšæ®µæ¢ä»¶è§¸ç™¼
**é©—è­‰**ï¼šåŸºæ–¼éšæ®µçš„æµç¨‹æ§åˆ¶

### å ´æ™¯ 2ï¼šå§“åæ”¶é›†
**è¼¸å…¥**ï¼š"My name is John Smith"
**é æœŸ**ï¼šé€²å±•åˆ°è¯çµ¡è©³æƒ…éšæ®µ
**é©—è­‰**ï¼šä¿¡æ¯æ”¶é›†å’Œéšæ®µé€²å±•

### å ´æ™¯ 3ï¼šæŠ—æ‹’è™•ç†
**è¼¸å…¥**ï¼š"I don't want to give my contact details yet"
**é æœŸ**ï¼šç¼ºå¤±è¯çµ¡æ¢ä»¶è§¸ç™¼
**é©—è­‰**ï¼šæ¢ä»¶æŒ‡ä»¤æ›´æ–°

### å ´æ™¯ 4-5ï¼šéƒ¨åˆ†è¯çµ¡ä¿¡æ¯
**è¼¸å…¥**ï¼šå…ˆé›»å­éƒµä»¶ï¼Œç„¶å¾Œé›»è©±
**é æœŸ**ï¼šæ¼¸é€²å¼å®Œæˆè¿½è¹¤
**é©—è­‰**ï¼šå¢é‡é€²åº¦æ¢ä»¶

### å ´æ™¯ 6ï¼šåå¥½æ”¶é›†
**è¼¸å…¥**ï¼šèˆˆè¶£å’Œæ„›å¥½ä¿¡æ¯
**é æœŸ**ï¼šåå¥½æ¢ä»¶è™•ç†
**é©—è­‰**ï¼šè‡ªå®šç¾©æ¬„ä½é©—è­‰

### å ´æ™¯ 7ï¼šå»¶é•·å°è©±
**è¼¸å…¥**ï¼šé¡å¤–çš„å°è©±è¼ªæ¬¡
**é æœŸ**ï¼šè¨Šæ¯è¨ˆæ•¸æ¢ä»¶è§¸ç™¼
**é©—è­‰**ï¼šé•·å°è©±å„ªåŒ–

### å ´æ™¯ 8ï¼šå®Œæˆé©—è­‰
**è¼¸å…¥**ï¼š"Is that everything? Am I done now?"
**é æœŸ**ï¼šæœ€çµ‚é©—è­‰å’Œå®Œæˆ
**é©—è­‰**ï¼šç«¯åˆ°ç«¯æ¢ä»¶æµç¨‹

## é‹è¡Œç¯„ä¾‹

### å‰ç½®æ¢ä»¶
1. Go 1.22 æˆ–æ›´é«˜ç‰ˆæœ¬
2. OpenAI API é‡‘é‘°

### è¨­å®š
1. **é…ç½®ç’°å¢ƒ**ï¼š
   ```bash
   cp .env.example .env
   # ç·¨è¼¯ .env ä¸¦æ·»åŠ æ‚¨çš„ OpenAI API é‡‘é‘°
   ```

2. **å®‰è£ä¾è³´**ï¼š
   ```bash
   go mod tidy
   ```

3. **é‹è¡Œç¯„ä¾‹**ï¼š
   ```bash
   go run main.go
   ```

## é æœŸè¼¸å‡º

```
ğŸ§ª æ¢ä»¶æ¸¬è©¦èˆ‡æµç¨‹è¦å‰‡æ¼”ç¤º
æ¸¬è©¦å„ç¨®æ¢ä»¶é¡å‹å’Œæµç¨‹è¦å‰‡è§¸ç™¼...
============================================================

ğŸ”„ æ¸¬è©¦ 1/8
ğŸ‘¤ ç”¨æˆ¶ï¼šHi! I want to sign up for your service.
ğŸ¯ CONDITION[at_basic_info_stage]: Stage 'basic_info' == 'basic_info' ? true
ğŸ¤– ä»£ç†ï¼šæ­¡è¿ï¼æˆ‘å°‡å¹«åŠ©æ‚¨è¨»å†Šã€‚è®“æˆ‘å€‘å¾æ‚¨çš„å§“åé–‹å§‹...
ğŸ“Š ç‹€æ…‹ï¼šStage=basic_info, Missing=[name email phone preferences], Complete=false

ğŸ”„ æ¸¬è©¦ 3/8  
ğŸ‘¤ ç”¨æˆ¶ï¼šI don't want to give my contact details yet
ğŸ¯ CONDITION[missing_contact_info]: Field 'email' is missing
ğŸ¯ CONDITION[missing_contact_info]: Field 'phone' is missing
ğŸ¤– ä»£ç†ï¼šæˆ‘ç†è§£æ‚¨å°éš±ç§çš„æ“”æ†‚ã€‚æˆ‘å€‘éœ€è¦æ‚¨çš„è¯çµ¡ä¿¡æ¯ä»¥ä¾¿...
ğŸ“Š ç‹€æ…‹ï¼šStage=contact_details, Missing=[email phone], Complete=false

ğŸ”„ æ¸¬è©¦ 7/8
ğŸ‘¤ ç”¨æˆ¶ï¼šActually, let me add that I also enjoy photography and hiking
ğŸ¯ CONDITION[long_conversation]: Message count 7 >= 6 ? true
ğŸ¤– ä»£ç†ï¼šå¾ˆæ£’çš„é¡å¤–èˆˆè¶£ï¼è®“æˆ‘ç¸½çµä¸€ä¸‹æˆ‘å€‘è¿„ä»Šç‚ºæ­¢æ”¶é›†çš„ä¿¡æ¯...
ğŸ“Š ç‹€æ…‹ï¼šStage=completed, Missing=[], Complete=true
```

## å­¸ç¿’æˆæœ

é€™å€‹ç¯„ä¾‹æ¼”ç¤ºäº†ï¼š

1. **æ¢ä»¶å¤šæ¨£æ€§**ï¼šä¸åŒé¡å‹çš„æ¢ä»¶ç”¨æ–¼å„ç¨®ä½¿ç”¨æ¡ˆä¾‹
2. **æµç¨‹æ§åˆ¶**ï¼šæ¢ä»¶å¦‚ä½•å‹•æ…‹ä¿®æ”¹ä»£ç†è¡Œç‚º
3. **è‡ªå®šç¾©é‚è¼¯**ï¼šå¯¦ç¾é ˜åŸŸç‰¹å®šçš„æ¢ä»¶é‚è¼¯
4. **ç‹€æ…‹ç®¡ç†**ï¼šé€šéçµæ§‹åŒ–è¼¸å‡ºè¿½è¹¤è¤‡é›œç‹€æ…‹
5. **ç”¨æˆ¶é«”é©—**ï¼šå‰µå»ºè‡ªç„¶ã€é©æ‡‰æ€§çš„å°è©±æµç¨‹

## é—œéµå¯¦ç¾æ¨¡å¼

### è‡ªå®šç¾©æ¢ä»¶å¯¦ç¾
```go
func (c *MissingFieldsCondition) Evaluate(ctx context.Context, session agent.Session, data map[string]any) (bool, error) {
    // å¾çµæ§‹åŒ–è¼¸å‡ºä¸­æå–ç¼ºå¤±æ¬„ä½
    missingFields, exists := data["missing_fields"]
    if !exists {
        return false, nil
    }
    
    // æª¢æŸ¥æ˜¯å¦æœ‰ä»»ä½•ç›®æ¨™æ¬„ä½ç¼ºå¤±
    for _, targetField := range c.fields {
        if contains(missing, targetField) {
            return true, nil  // æ¢ä»¶æ»¿è¶³
        }
    }
    
    return false, nil  // æ¢ä»¶ä¸æ»¿è¶³
}
```

### æµç¨‹è¦å‰‡å‰µå»º
```go
rule, err := agent.NewFlowRule("collect-contact-info", missingContactCondition).
    WithDescription("æç¤ºç”¨æˆ¶æä¾›ç¼ºå¤±çš„è¯çµ¡ä¿¡æ¯").
    WithNewInstructions("å°ˆæ³¨æ–¼æ”¶é›†é›»å­éƒµä»¶å’Œé›»è©±...").
    WithRecommendedTools("collect_user_info").
    WithSystemMessage("éœ€è¦è¯çµ¡ä¿¡æ¯").
    Build()
```

### çµæ§‹åŒ–è¼¸å‡ºæ•´åˆ
```go
agent.New(
    // ... å…¶ä»–é¸é …
    agent.WithStructuredOutput(&UserStatusOutput{}),
    agent.WithFlowRules(flowRules...),
)
```

## æ¶æ§‹å„ªå‹¢

1. **æ¨¡çµ„åŒ–**ï¼šæ¢ä»¶æ˜¯ç¨ç«‹ä¸”å¯é‡ç”¨çš„
2. **å¯æ¸¬è©¦æ€§**ï¼šæ¯å€‹æ¢ä»¶éƒ½å¯ä»¥å–®ç¨æ¸¬è©¦
3. **éˆæ´»æ€§**ï¼šæ˜“æ–¼æ·»åŠ æ–°çš„æ¢ä»¶é¡å‹
4. **å¯ç¶­è­·æ€§**ï¼šé‚è¼¯å’Œé…ç½®çš„æ¸…æ™°åˆ†é›¢
5. **å¯æ“´å±•æ€§**ï¼šæ¡†æ¶è™•ç†è¤‡é›œçš„æ¢ä»¶ç·¨æ’

## å¸¸è¦‹ç”¨ä¾‹

é€™ç¨®æ¨¡å¼é©ç”¨æ–¼ï¼š
- **ç”¨æˆ¶å…¥è·**ï¼šå¤šæ­¥é©Ÿè¨»å†Šæµç¨‹
- **è¡¨å–®é©—è­‰**ï¼šåŸºæ–¼ç”¨æˆ¶è¼¸å…¥çš„å‹•æ…‹è¡¨å–®è¡Œç‚º
- **å·¥ä½œæµç®¡ç†**ï¼šæ¢ä»¶æµç¨‹æµ
- **å®¢æˆ¶æ”¯æ´**ï¼šä¸Šä¸‹æ–‡æ„ŸçŸ¥å›æ‡‰è™•ç†
- **é›»å­å•†å‹™**ï¼šé©æ‡‰æ€§çµå¸³å’Œæ¨è–¦æµç¨‹